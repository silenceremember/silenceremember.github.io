# Заголовки кеширования для оптимизации производительности
# Оптимизировано для максимальной производительности и Core Web Vitals

# Статические ресурсы (изображения, шрифты, CSS, JS) - кешируются на год
/assets/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# HTML файлы - короткое кеширование для обновлений контента
# Добавлен stale-while-revalidate для лучшей производительности
/*.html
  Cache-Control: public, max-age=3600, must-revalidate, stale-while-revalidate=86400
  X-Content-Type-Options: nosniff

# JSON данные - кешируются на час с revalidation
/data/*.json
  Cache-Control: public, max-age=3600, must-revalidate
  Content-Type: application/json
  X-Content-Type-Options: nosniff

# Шрифты - кешируются на год с CORS для кросс-доменных запросов
/assets/fonts/*
  Cache-Control: public, max-age=31536000, immutable
  Access-Control-Allow-Origin: *
  X-Content-Type-Options: nosniff

# Google Fonts - кешируются на год
https://fonts.gstatic.com/*
  Cache-Control: public, max-age=31536000, immutable
  Access-Control-Allow-Origin: *

# SVG файлы - кешируются на год
/*.svg
  Cache-Control: public, max-age=31536000, immutable
  Content-Type: image/svg+xml
  X-Content-Type-Options: nosniff

# Изображения - кешируются на год
/assets/images/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff
# Изображения с query параметрами (оптимизированные версии)
/assets/images/*?*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# JavaScript файлы - кешируются на год
/assets/js/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff
/assets/*.js
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# CSS файлы - кешируются на год
/assets/css/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff
/assets/*.css
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# Статические JS файлы в корне
/js/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# Компоненты HTML - кешируются на 1 час (переопределяет правило выше для HTML)
/components/*.html
  Cache-Control: public, max-age=3600
  X-Content-Type-Options: nosniff

# Остальные компоненты (JS, CSS и т.д.) - кешируются на год
/components/*
  Cache-Control: public, max-age=31536000, immutable
  X-Content-Type-Options: nosniff

# Безопасность и производительность
/*
  X-Frame-Options: DENY
  X-XSS-Protection: 1; mode=block
  Referrer-Policy: strict-origin-when-cross-origin
  X-Content-Type-Options: nosniff
  Strict-Transport-Security: max-age=31536000; includeSubDomains
  Cross-Origin-Opener-Policy: same-origin
  Cross-Origin-Embedder-Policy: credentialless
  Permissions-Policy: geolocation=(), microphone=(), camera=()
  # Content-Security-Policy: разрешаем Google Drive для встраивания документов
  # frame-src разрешает загрузку iframes с Google Drive и Google Docs
  # Убрали 'unsafe-inline' и 'unsafe-eval' из script-src для безопасности
  # Примечание: CSP warnings от Google Drive внутри iframe - это нормально и ожидаемо
  # Google Drive устанавливает свою собственную CSP политику внутри iframe, которую мы не можем контролировать
  # Добавлены дополнительные директивы для лучшей поддержки Google Drive: form-action, script-src-elem, style-src-elem
  Content-Security-Policy: default-src 'self'; script-src 'self' https://fonts.googleapis.com; script-src-elem 'self' https://fonts.googleapis.com https://*.google.com https://*.googleapis.com https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; style-src-elem 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://*.google.com https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https: blob:; frame-src 'self' https://drive.google.com https://docs.google.com https://accounts.google.com https://clients6.google.com https://*.google.com https://*.googleapis.com; connect-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com https://drive.google.com https://docs.google.com https://accounts.google.com https://clients6.google.com https://*.google.com https://*.googleapis.com https://*.gstatic.com https://www.google-analytics.com https://www.googletagmanager.com; form-action 'self' https://accounts.google.com https://*.google.com; worker-src 'self' blob:; object-src 'self' data: blob:; base-uri 'self'; frame-ancestors 'none'; upgrade-insecure-requests; require-trusted-types-for 'script'

# Оптимизация для Core Web Vitals
# Preconnect для внешних ресурсов (если используются)
# Link: <https://fonts.googleapis.com>; rel=preconnect
# Link: <https://fonts.gstatic.com>; rel=preconnect; crossorigin

