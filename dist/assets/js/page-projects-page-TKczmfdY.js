import{B as h}from"./page-base-page-BgJtuGQo.js";import{C as j}from"./factories-ClXea4bO.js";import{P as m,b as y}from"./managers-BD3WS2NZ.js";import{c as C,P,l as s,g as x}from"./utils-DDkmD0RB.js";import"./components-scroll-CzkIP5QM.js";import"./layout-C0B9eYKg.js";import"./components-core-CO-goFmY.js";import"./services-ERvBTkKF.js";class I extends h{constructor(){super({navigationSelector:".projects-navigation",imageSelector:".project-card-image"}),this.filtersManager=null,this.groupingManager=null,this.projectCardTemplate=null,this.allProjects=[],this.allProjectCards=new Map}async loadProjectTemplate(){return this.projectCardTemplate||(this.projectCardTemplate=await this.loadPageTemplate("/components/project-card.html",".project-card")),this.projectCardTemplate}async loadProjectsData(){const t=await this.loadPageDataArray("/data/projects.json","projects",[]);return this.autoSetComingSoon(t)}autoSetComingSoon(t){return t.map(o=>o.comingSoon===!0||o.comingSoon===!1||o.links&&typeof o.links=="object"&&Object.keys(o.links).length>0&&Object.values(o.links).some(e=>e&&typeof e=="string"&&e.trim().length>0)?o:{...o,comingSoon:!0})}openProjectDetails(t){if(!t.comingSoon){if(t.links&&t.links.site){window.open(t.links.site,"_blank","noopener,noreferrer");return}if(t.links&&Object.keys(t.links).length>0){const o=Object.values(t.links)[0];if(o){window.open(o,"_blank","noopener,noreferrer");return}}}}async initFilters(t){this.filtersManager?(this.filtersManager.projects=t,this.filtersManager.allProjectCards=this.allProjectCards):this.filtersManager=new m(t,this.allProjectCards,{onCardClick:o=>this.openProjectDetails(o),onRenderGrouped:()=>this.renderGroupedProjects(),onHideLoading:()=>this.loadingIndicator.hide(),onExpandedSectionsClear:()=>{this.groupingManager&&this.groupingManager.expandedSections.clear()}}),await this.filtersManager.init(t)}async renderGroupedProjects(){if(!this.groupingManager){console.warn("Менеджер группировки не инициализирован");return}await this.groupingManager.renderGroupedProjects()}async createProjectCardsBatched(t,o=15){return new Promise(r=>{let e=0;const i=()=>{const p=Math.min(e+o,t.length);for(let c=e;c<p;c++){const l=t[c],n=j.createProjectCard(this.projectCardTemplate,l,a=>this.openProjectDetails(a));n&&this.allProjectCards.set(l.id,n)}e=p,e<t.length?requestAnimationFrame(()=>{window.requestIdleCallback?requestIdleCallback(i,{timeout:50}):setTimeout(i,0)}):r()};requestAnimationFrame(i)})}async init(){await this.initBase(),this.initLoadingIndicator("projects-loading","projects-loading-container"),this.loadingIndicator.show();const[t,o]=await Promise.all([this.loadProjectsData(),this.loadProjectTemplate()]),r=this.loadingIndicator.hide();if(t.length===0)return;this.allProjects=t,await Promise.all([r,this.createProjectCardsBatched(t)]),this.groupingManager?(this.groupingManager.projects=this.allProjects,this.groupingManager.allProjectCards=this.allProjectCards):this.groupingManager=new y(this.allProjects,this.allProjectCards,{onCardClick:i=>this.openProjectDetails(i),onHideLoading:()=>this.loadingIndicator.hide()});const[e]=await Promise.all([this.renderGroupedProjects(),this.initFilters(t)]);requestAnimationFrame(()=>{C.loadAllImages()}),await P.waitForFontsLoaded(),this.languageChangeHandler=()=>{this.updateContentLanguage()},this.updateContentLanguage(),window.addEventListener("languageChanged",this.languageChangeHandler)}updateContentLanguage(){if(document.querySelectorAll(".project-card").forEach(t=>{const o=t.getAttribute("data-project-id");if(!o)return;const r=this.allProjects.find(a=>a.id===o);if(!r)return;const e=t.querySelector(".project-card-title");if(e){const a=s.getCurrentLanguage(),g=r.titleLocalized&&r.titleLocalized[a]?r.titleLocalized[a]:r.title,u=e.querySelector(".project-card-star"),f=e.querySelector(".project-card-divider");if(Array.from(e.childNodes).filter(d=>d.nodeType===Node.TEXT_NODE).forEach(d=>d.remove()),e.insertBefore(document.createTextNode(g),e.firstChild),r.featured&&!u){const d=document.createElement("span");d.className="project-card-star",d.setAttribute("data-svg-src","assets/images/icon-star.svg"),d.setAttribute("aria-label",s.t("projects.card.featured")),e.appendChild(d)}if(r.tier===2&&!f){const d=document.createElement("span");d.className="project-card-divider",d.setAttribute("data-svg-src","assets/images/icon-divider-small.svg"),d.setAttribute("aria-label",s.t("projects.card.tier2")),e.appendChild(d)}}const i=t.querySelector(".project-card-description");if(i){const a=s.getCurrentLanguage();r.descriptionLocalized&&r.descriptionLocalized[a]?i.textContent=r.descriptionLocalized[a]:i.textContent=r.description||""}const p=t.querySelector(".project-card-status");if(p){const a=r.status==="completed"?"completed":"inDevelopment";p.textContent=s.t(`projects.filters.statuses.${a}`)}const c=t.querySelector(".project-card-type");if(c&&r.type){const a={game:s.t("projects.card.types.game"),document:s.t("projects.card.types.document"),tool:s.t("projects.card.types.tool"),script:s.t("projects.card.types.script")};c.textContent=a[r.type]||r.type}const l=t.querySelector(".project-card-role");l&&(l.textContent=x(r.role,!1,r.teamName));const n=t.querySelector(".project-card-button");if(n)if(r.comingSoon)n.textContent=s.t("projects.card.comingSoon"),n.setAttribute("aria-label",s.t("projects.card.comingSoonAria"));else{const a=n.querySelector("span[data-i18n]");a?a.textContent=s.t("projects.card.details"):n.textContent=s.t("projects.card.details"),n.setAttribute("aria-label",s.t("projects.card.detailsAria"))}}),this.filtersManager){const t=document.querySelector(".project-filters-content");t&&t.querySelectorAll(".project-filters-group").forEach((i,p)=>{const c=i.querySelector(".project-filters-group-title");if(c){const l=i.querySelector("[data-filter]");if(l){const n=l.getAttribute("data-filter"),a={category:"projects.filters.category",status:"projects.filters.status",year:"projects.filters.year"};a[n]&&(c.textContent=s.t(a[n]))}else{const n=c.getAttribute("data-i18n");n&&(c.textContent=s.t(n))}}}),document.querySelectorAll(".project-filters-group-title").forEach(e=>{const i=e.getAttribute("data-i18n");i&&(e.textContent=s.t(i))}),document.querySelectorAll(".project-filters-option-label").forEach(e=>{var p;const i=e.getAttribute("data-i18n");if(i)e.textContent=s.t(i);else{const c=e.closest(".project-filters-option");if(c){const l=c.getAttribute("data-value"),n=(p=c.closest("[data-filter]"))==null?void 0:p.getAttribute("data-filter");if(n==="category"){const a={games:"projects.filters.categories.games",tools:"projects.filters.categories.tools",research:"projects.filters.categories.research"};a[l]&&(e.textContent=s.t(a[l]))}else if(n==="status"){const a={completed:"projects.filters.statuses.completed","in-development":"projects.filters.statuses.inDevelopment"};a[l]&&(e.textContent=s.t(a[l]))}}}});const o=document.getElementById("project-filters-reset");if(o){const e=o.querySelector(".projects-section-expand-text");e&&(e.textContent=s.t("projects.filters.reset")),o.setAttribute("aria-label",s.t("projects.filters.resetAria"))}const r=document.querySelector("#project-filters-results .projects-section-title-text");r&&(r.textContent=s.t("projects.filters.found"))}if(this.groupingManager){const t={games:s.t("projects.filters.categories.games"),tools:s.t("projects.filters.categories.tools"),research:s.t("projects.filters.categories.research")};document.querySelectorAll(".projects-section-title-text").forEach(o=>{const r=o.closest(".projects-section");if(r){const e=r.getAttribute("data-category");e&&t[e]&&(o.textContent=t[e])}}),document.querySelectorAll(".projects-section-expand-text").forEach(o=>{const r=o.closest(".projects-section-expand");r&&r.getAttribute("aria-expanded")==="true"?o.textContent=s.t("projects.filters.hide"):r&&(o.textContent=s.t("projects.filters.showAll"))})}}cleanup(){var t;this.languageChangeHandler&&window.removeEventListener("languageChanged",this.languageChangeHandler),(t=super.cleanup)==null||t.call(this)}}export{I as ProjectsPage};
