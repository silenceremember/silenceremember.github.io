import{B as x}from"./page-base-page-DE7KUBcH.js";import{C}from"./factories-ClXea4bO.js";import{D as g,l,d as f,b as w,a as S,S as b}from"./utils-DDkmD0RB.js";import"./managers-BD3WS2NZ.js";import"./layout-C0B9eYKg.js";import"./components-scroll-CzkIP5QM.js";import"./components-core-CO-goFmY.js";import"./services-CkGXMzVl.js";class I extends x{constructor(){super({navigationSelector:".research-navigation",imageSelector:".research-card img"}),this.researchCardTemplate=null,this.publications=[]}async loadResearchTemplate(){return this.researchCardTemplate||(this.researchCardTemplate=await this.loadPageTemplate("/components/research-card.html",".research-card")),this.researchCardTemplate}async loadResearchData(){return this.loadPageDataArray("/data/research.json","publications",[])}groupPublicationsByYear(h){const e={};return h.forEach(s=>{const o=g.getYearFromDate(s.date);o&&(e[o]||(e[o]=[]),e[o].push(s))}),e}async init(){await this.initBase(),this.languageChangeHandler=()=>{this.updateContentLanguage()},window.addEventListener("languageChanged",this.languageChangeHandler),this.initLoadingIndicator("research-loading","research-loading-container"),this.loadingIndicator.show(),await this.loadResearchTemplate();const h=await this.loadResearchData();this.publications=h,await this.loadingIndicator.hide();const e=document.getElementById("research-publications-section"),s=document.getElementById("research-diploma-section");if(e&&(e.style.visibility="visible",(!e.style.opacity||e.style.opacity==="")&&(e.style.opacity="0")),s&&(s.style.visibility="visible",(!s.style.opacity||s.style.opacity==="")&&(s.style.opacity="0")),h.length===0){if(e){e.innerHTML=`<p>${l.t("research.errors.noPublications")}</p>`;const a=e.style.opacity;(a==="0"||!a||a==="")&&(e.style.transition="opacity 0.3s ease-in-out",e.style.opacity="1",setTimeout(()=>{e.style.opacity="",e.style.transition=""},300)),e.style.visibility=""}return}const o=h.find(a=>a.type==="diploma"),u=h.filter(a=>a.type!=="diploma");if(o&&s){const a=document.createElement("h2");a.className="research-section-title",a.textContent=l.t("research.diploma.title"),s.appendChild(a);const c=document.createElement("div");c.className="research-grid research-grid-diploma";const n=C.createResearchCard(this.researchCardTemplate,o);n&&(n.style.opacity="0",n.style.transform="translateY(10px)",n.style.transition="none",c.appendChild(n)),s.appendChild(c),requestAnimationFrame(()=>{const r=s.style.opacity;(r==="0"||!r||r==="")&&f(s),n&&w(n,{skipInitialState:!0})})}u.sort((a,c)=>{var d,i;const n=g.getYearFromDate(a.date)||0,r=g.getYearFromDate(c.date)||0;return r!==n?r-n:(d=a.date)!=null&&d.start&&((i=c.date)!=null&&i.start)?new Date(c.date.start)-new Date(a.date.start):0});const t=this.groupPublicationsByYear(u),y=Object.keys(t).sort((a,c)=>parseInt(c)-parseInt(a));if(e&&y.length>0){const a=document.createDocumentFragment();y.forEach(c=>{const n=document.createElement("h2");n.className="research-year-header",n.textContent=c,a.appendChild(n);const r=document.createElement("div");r.className="research-grid",t[c].forEach(d=>{const i=C.createResearchCard(this.researchCardTemplate,d);i&&(i.style.opacity="0",i.style.transform="translateY(10px)",i.style.transition="none",r.appendChild(i))}),a.appendChild(r)}),e.appendChild(a),requestAnimationFrame(()=>{const c=e.style.opacity;(c==="0"||!c||c==="")&&f(e);const n=e.querySelectorAll(".research-card");n.length>0&&S(n,{skipInitialState:!0})})}else if(e){const a=e.style.opacity;(a==="0"||!a||a==="")&&f(e)}s&&!o&&s.style.opacity==="0"&&s.children.length===0&&(s.style.visibility="hidden"),await this.waitForPageReady(),this.updateContentLanguage()}updateContentLanguage(){const h=new Map;this.publications&&this.publications.forEach(o=>{h.set(o.id,o)});const e=l.getCurrentLanguage(),s=document.querySelector("#research-diploma-section .research-section-title");s&&(s.textContent=l.t("research.diploma.title")),document.querySelectorAll(".research-card").forEach(o=>{const u=o.getAttribute("data-research-id"),t=u?h.get(u):null,y=o.querySelector(".research-card-title");y&&t&&(t.titleLocalized&&t.titleLocalized[e]?y.textContent=t.titleLocalized[e]:y.textContent=t.title);const a=o.querySelector(".research-card-journal");if(a&&t&&t.journal){let i="";if(t.journalLocalized&&t.journalLocalized[e]?i=t.journalLocalized[e]:i=t.journal,t.location){const p=t.locationLocalized&&t.locationLocalized[e]?t.locationLocalized[e]:t.location;i+=` (${p})`}a.textContent=i}const c=o.querySelector(".research-card-keywords");if(c&&t&&t.keywords&&t.keywords.length>0){const i=t.keywordsLocalized&&t.keywordsLocalized[e]?t.keywordsLocalized[e]:t.keywords;c.innerHTML="",i.forEach(p=>{const m=document.createElement("span");m.className="research-card-keyword",m.textContent=p,c.appendChild(m)})}const n=o.querySelector(".research-card-type");if(n)if(t)n.textContent=b.getTypeText(t.type);else{const i=o.getAttribute("data-type");i&&(n.textContent=b.getTypeText(i))}const r=o.querySelector(".research-card-button");if(r)if(t)if(t.links&&Object.keys(t.links).length>0&&Object.values(t.links).some(p=>p&&typeof p=="string"&&p.trim().length>0)){const p=r.querySelector("span[data-i18n]")||r;p.textContent&&(p.textContent=l.t("research.card.read")),r.setAttribute("aria-label",l.t("research.card.readAria")),r.disabled=!1}else r.textContent=l.t("research.card.comingSoon"),r.setAttribute("aria-label",l.t("research.card.comingSoonAria")),r.disabled=!0;else{const i=r.querySelector("span[data-i18n]")||r;i.textContent&&(i.textContent=l.t("research.card.read")),r.setAttribute("aria-label",l.t("research.card.readAria"))}const d=o.querySelector(".research-card-level");if(d&&d.textContent){const i=d.textContent.trim();i==="РИНЦ"||i==="RSCI"?d.textContent=l.t("research.levels.RSCI"):i==="Scopus"&&(d.textContent=l.t("research.levels.Scopus"))}})}destroy(){this.languageChangeHandler&&window.removeEventListener("languageChanged",this.languageChangeHandler)}}export{I as ResearchPage};
