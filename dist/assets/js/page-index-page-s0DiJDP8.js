import{B as p}from"./page-base-page-Bp2cLyNB.js";import{l as c,g as m,P as C}from"./utils-CKrc6ags.js";import{SlidesManager as y}from"./components-B-C0YwKp.js";import{b as h}from"./services-lW0kxgGc.js";import{S as f}from"./managers-BeWNv7uO.js";import"./components-scroll-CzkIP5QM.js";import"./layout-CcHcqC4y.js";import"./components-core-BE8PsulO.js";import"./components-svg-D1ZYaihp.js";import"./components-background-BXvjSBPs.js";class k extends p{constructor(){super({navigationSelector:"#cta-section",imageSelector:'.slide[data-slide="0"] img'}),this.slideAnimationManager=null,this.slidesContainer=null,this.slidesManager=null,this.featuredProjects=[]}async loadProjectsData(){return this.loadPageDataArray("/data/projects.json","projects",[])}getProjectSlides(){return this.slidesContainer?Array.from(this.slidesContainer.querySelectorAll(".slide[data-slide]")).filter(t=>{const e=parseInt(t.getAttribute("data-slide"));return e>0&&e<4}).sort((t,e)=>{const n=parseInt(t.getAttribute("data-slide")),i=parseInt(e.getAttribute("data-slide"));return n-i}):[]}populateProjectSlide(t,e,n=0){var l,d;const i=t.querySelector(".project-title");if(i){const o=c.getCurrentLanguage();let u=e.title;e.titleLocalized&&e.titleLocalized[o]&&(u=e.titleLocalized[o]),i.textContent=u.toUpperCase()}const a=t.querySelector(".project-meta");if(a&&e.displayMeta){const o=a.querySelectorAll("span");o.length>=2&&(o[0].textContent=e.displayMeta.genre,o[1].textContent=e.displayMeta.platform)}const s=t.querySelector(".details-block:first-of-type .details-text");if(s){const o=m(e.role,!0,e.teamName);s.textContent=o}const r=t.querySelector(".details-block:last-of-type .details-text");if(r&&e.keyContribution){const o=c.getCurrentLanguage();e.keyContributionLocalized&&e.keyContributionLocalized[o]?r.textContent=e.keyContributionLocalized[o]:r.textContent=e.keyContribution}if((l=e.media)!=null&&l.preview){const o=t.querySelector(".project-placeholder");if(o){const b=((d=this.slidesContainer)==null?void 0:d.classList.contains("tablet-scroll-mode"))||window.innerWidth<1024||window.innerHeight<900||n<=2;h.loadBackgroundImage(o,e.media.preview,b)}}}populateProjectSlides(t){const e=this.getProjectSlides();if(e.length===0){console.warn("Слайды проектов не найдены");return}const n=t.slice(0,e.length);if(n.length===0){console.warn("Featured проекты не найдены");return}n.forEach((i,a)=>{a<e.length&&this.populateProjectSlide(e[a],i,a)})}loadSlideImage(t){var r,l;if(t<1||t>3)return;const e=t-1,n=this.featuredProjects[e];if(!n||!((r=n.media)!=null&&r.preview))return;const i=(l=this.slidesContainer)==null?void 0:l.querySelector(`.slide[data-slide="${t}"]`);if(!i)return;const a=i.querySelector(".project-placeholder");if(!a)return;const s=a.style.backgroundImage;s&&s!=="none"&&s.includes(n.media.preview)||(h.unobserve(a),a.dataset.bgImage&&delete a.dataset.bgImage,h.loadBackgroundImage(a,n.media.preview,!0))}async initSlideAnimationManager(){if(this.slidesContainer)return this.slideAnimationManager||(this.slideAnimationManager=new f(this.slidesContainer)),this.slideAnimationManager}async init(){if(this.slidesContainer=document.querySelector(".slides-container"),!this.slidesContainer)return;await this.initBase(),this.initLoadingIndicator("index-loading","index-loading-container"),this.loadingIndicator.show();const t=this.loadProjectsData();this.slidesManager=new y,this.slidesManager.init(),this.setupSlideImageLoading();const e=await t;await this.loadingIndicator.hide(),this.featuredProjects=e.filter(n=>n.featured===!0),this.populateProjectSlides(this.featuredProjects),await this.initSlideAnimationManager(),await C.waitForFontsLoaded(),await new Promise(n=>requestAnimationFrame(()=>{requestAnimationFrame(n)})),this.slideAnimationManager&&this.slideAnimationManager.initializeFirstSlideAnimation(),this.languageChangeHandler=()=>{this.updateContentLanguage()},this.updateContentLanguage(),window.addEventListener("languageChanged",this.languageChangeHandler)}setupSlideImageLoading(){if(!this.slidesContainer)return;const t=new MutationObserver(i=>{i.forEach(a=>{if(a.type==="attributes"&&a.attributeName==="class"){const s=a.target;if(s.classList.contains("active")&&s.classList.contains("slide")){const r=parseInt(s.getAttribute("data-slide"));r>=1&&r<=3&&(this.slidesContainer.classList.contains("tablet-scroll-mode")||this.loadSlideImage(r))}}})}),e=new MutationObserver(i=>{i.forEach(a=>{if(a.type==="attributes"&&a.attributeName==="class"){const s=a.target;s===this.slidesContainer&&s.classList.contains("tablet-scroll-mode")&&this.loadAllSlideImages()}})});this.slidesContainer.querySelectorAll(".slide").forEach(i=>{t.observe(i,{attributes:!0,attributeFilter:["class"]})}),e.observe(this.slidesContainer,{attributes:!0,attributeFilter:["class"]}),this.slideImageObserver=t,this.containerImageObserver=e,this.slidesContainer.classList.contains("tablet-scroll-mode")&&this.loadAllSlideImages()}loadAllSlideImages(){for(let t=1;t<=3;t++)this.loadSlideImage(t)}updateContentLanguage(){this.getProjectSlides().forEach((e,n)=>{const i=this.featuredProjects[n];if(!i)return;const a=e.querySelector(".project-title");if(a){const l=c.getCurrentLanguage();let d=i.title;i.titleLocalized&&i.titleLocalized[l]&&(d=i.titleLocalized[l]),a.textContent=d.toUpperCase()}const s=e.querySelector(".details-block:first-of-type .details-text");s&&(s.textContent=m(i.role,!0,i.teamName));const r=e.querySelector(".details-block:last-of-type .details-text");if(r&&i.keyContribution){const l=c.getCurrentLanguage();i.keyContributionLocalized&&i.keyContributionLocalized[l]?r.textContent=i.keyContributionLocalized[l]:r.textContent=i.keyContribution}})}cleanup(){var t;this.languageChangeHandler&&window.removeEventListener("languageChanged",this.languageChangeHandler),this.slideImageObserver&&(this.slideImageObserver.disconnect(),this.slideImageObserver=null),this.containerImageObserver&&(this.containerImageObserver.disconnect(),this.containerImageObserver=null),(t=super.cleanup)==null||t.call(this)}}async function q(){const g=document.querySelector(".slides-container");if(g)try{new f(g).hideAllSlideElementsImmediately()}catch(t){console.warn("Could not hide slide elements early:",t)}}export{k as IndexPage,q as hideAllSlideElementsEarly};
