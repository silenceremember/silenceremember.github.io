import{l as n}from"./utils-BFWi1tiH.js";class h{constructor(){this.cursor=null,this.isHoverSupported=!1,this.isTouching=!1,this.touchTimeout=null,this.targetX=0,this.targetY=0,this.currentX=0,this.currentY=0,this.rafId=null,this.lastHoverCheck=0,this.lastHoverCheckX=0,this.lastHoverCheckY=0,this.isHovering=!1,this.isVisible=!1,this.storageDebounceTimer=null,this.pendingStorageX=null,this.pendingStorageY=null,this.interactiveSelector="a, button, .header-language, .header-theme, .social-link, .footer-decorative-square, .header-menu-button, .project-card, .research-card",this.isInitialized=!1}init(){if(!this.isInitialized){if(this.cursor=document.querySelector(".custom-cursor"),this.isHoverSupported=window.matchMedia("(hover: hover)").matches,!this.cursor||!this.isHoverSupported){this.cursor&&(this.cursor.style.display="none");return}this.restorePosition(),this.setupTouchHandlers(),this.setupMouseHandlers(),this.setupBeforeUnload(),this.isInitialized=!0}}quickInit(){if(!this.isInitialized){if(this.cursor=document.querySelector(".custom-cursor"),this.isHoverSupported=window.matchMedia("(hover: hover)").matches,!this.cursor||!this.isHoverSupported){this.cursor&&(this.cursor.style.display="none");return}this.restorePosition()}}setupTouchHandlers(){window.addEventListener("touchstart",()=>{this.isTouching=!0,this.cursor.classList.remove("visible"),this.isVisible=!1,clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>{this.isTouching=!1},500)},{passive:!0})}restorePosition(){try{const i=sessionStorage.getItem("cursorX"),t=sessionStorage.getItem("cursorY");if(i&&t){const e=Number(i),s=Number(t);if(isNaN(e)||isNaN(s)||e<0||s<0)return;this.targetX=e,this.targetY=s,this.currentX=e,this.currentY=s,this.cursor.style.left=`${e}px`,this.cursor.style.top=`${s}px`,this.cursor.classList.add("visible"),this.isVisible=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.checkHoverState(e,s)})})}}catch(i){console.warn("Failed to restore cursor position:",i)}}updateCursorPosition(){this.currentX=this.targetX,this.currentY=this.targetY,this.cursor.style.left=`${this.currentX}px`,this.cursor.style.top=`${this.currentY}px`,this.rafId=null}savePositionToStorage(i,t){this.pendingStorageX=i,this.pendingStorageY=t,clearTimeout(this.storageDebounceTimer),this.storageDebounceTimer=setTimeout(()=>{this.pendingStorageX!==null&&this.pendingStorageY!==null&&(sessionStorage.setItem("cursorX",String(this.pendingStorageX)),sessionStorage.setItem("cursorY",String(this.pendingStorageY)),this.pendingStorageX=null,this.pendingStorageY=null)},500)}hideCursor(){this.isVisible&&(this.cursor.classList.remove("visible"),this.isVisible=!1),this.isHovering&&(this.cursor.classList.remove("hover"),this.isHovering=!1)}showCursor(){!this.isVisible&&!this.isTouching&&(this.cursor.classList.add("visible"),this.isVisible=!0)}checkHoverState(i,t){const e=performance.now(),s=Math.abs(i-this.lastHoverCheckX)+Math.abs(t-this.lastHoverCheckY),o=s>10?16:50;if(!(e-this.lastHoverCheck<o&&s<5)){this.lastHoverCheck=e,this.lastHoverCheckX=i,this.lastHoverCheckY=t,this.isVisible||(this.cursor.classList.add("visible"),this.isVisible=!0);try{const r=document.elementFromPoint(i,t),a=r&&r.closest(this.interactiveSelector);a&&!this.isHovering?(this.cursor.classList.add("hover"),this.isHovering=!0):!a&&this.isHovering&&(this.cursor.classList.remove("hover"),this.isHovering=!1)}catch{}}}setupMouseHandlers(){window.addEventListener("mousemove",i=>{if(this.isTouching)return;const t=i.clientX,e=i.clientY;this.targetX=t,this.targetY=e,this.isVisible||(this.cursor.classList.add("visible"),this.isVisible=!0),this.rafId||(this.rafId=requestAnimationFrame(()=>this.updateCursorPosition())),this.checkHoverState(t,e),this.savePositionToStorage(t,e)},{passive:!0})}setupBeforeUnload(){window.addEventListener("beforeunload",()=>{this.pendingStorageX!==null&&this.pendingStorageY!==null?(sessionStorage.setItem("cursorX",String(this.pendingStorageX)),sessionStorage.setItem("cursorY",String(this.pendingStorageY))):(this.targetX!==0||this.targetY!==0)&&(sessionStorage.setItem("cursorX",String(this.targetX)),sessionStorage.setItem("cursorY",String(this.targetY)))})}}class g{constructor(){this.languageButton=null,this.checkInterval=null,this.unsubscribe=null}async init(){if(await n.init(),this.languageButton=document.querySelector(".header-language"),!this.languageButton)return;const i=this.languageButton.querySelector(".language-icon-ru"),t=this.languageButton.querySelector(".language-icon-en");i&&t&&(i.classList.remove("active"),t.classList.remove("active")),this.applyLanguage(n.getCurrentLanguage()),this.languageButton.addEventListener("click",()=>this.toggleLanguage()),this.unsubscribe=n.subscribe(e=>{this.applyLanguage(e),this.updatePageContent()}),this.checkInterval=setInterval(()=>{const e=this.languageButton.querySelector(".language-icon-ru svg"),s=this.languageButton.querySelector(".language-icon-en svg");e&&s&&(this.applyLanguage(n.getCurrentLanguage()),clearInterval(this.checkInterval))},50),setTimeout(()=>{this.checkInterval&&clearInterval(this.checkInterval)},2e3),this.updatePageContent()}applyLanguage(i){var s,o;const t=(s=this.languageButton)==null?void 0:s.querySelector(".language-icon-ru"),e=(o=this.languageButton)==null?void 0:o.querySelector(".language-icon-en");if(!(!t||!e)&&(t.classList.remove("active"),e.classList.remove("active"),i==="ru"?t.classList.add("active"):e.classList.add("active"),this.languageButton)){const r=n.t("common.aria.languageSwitch");this.languageButton.setAttribute("aria-label",r)}}async toggleLanguage(){const t=n.getCurrentLanguage()==="ru"?"en":"ru";await n.switchLanguage(t)}updatePageContent(){const i=n.getCurrentLanguage();this.updateNavigation(),document.querySelectorAll("[data-i18n]").forEach(t=>{const e=t.getAttribute("data-i18n");if(!e)return;const s=n.t(e);s&&s!==e&&(t.textContent=s)}),document.querySelectorAll("[data-i18n-attr]").forEach(t=>{const e=t.getAttribute("data-i18n-attr"),[s,o]=e.split(":"),r=n.t(o);r&&s&&t.setAttribute(s,r)}),document.querySelectorAll("[data-i18n-attr-title]").forEach(t=>{const e=t.getAttribute("data-i18n-attr-title"),s=n.t(e);s&&t.setAttribute("title",s)}),this.updateMetaTags(),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:i}}))}updateNavigation(){const i=document.querySelectorAll(".header-nav-item"),t=["common.nav.home","common.nav.portfolio","common.nav.research","common.nav.cv","common.nav.community"];i.forEach((s,o)=>{if(t[o]){const r=n.t(t[o]);r&&(s.textContent=r)}}),document.querySelectorAll(".cta-button").forEach(s=>{const o=s.getAttribute("href");if(o){const a={"index.html":"common.nav.home","projects.html":"common.nav.portfolio","research.html":"common.nav.research","cv.html":"common.nav.cv","community.html":"common.nav.community"}[o];if(a){const u=n.t(a);u&&(s.textContent=u)}}})}updateMetaTags(){const i=window.location.pathname,t=i.split("/").pop()||"index.html";let e="",s="";if(t==="index.html"||t===""||i==="/"?s="index.meta_description":t==="projects.html"?(e="projects.meta_title",s="projects.description"):t==="research.html"?(e="research.meta_title",s="research.description"):t==="cv.html"?(e="cv.meta_title",s="cv.description"):t==="community.html"?(e="community.meta_title",s="community.description"):t==="404.html"&&(e="404.title",s="404.message"),e){const o=n.t(e);o&&(t==="404.html"?document.title=o+" | Maxim Elchaninov":document.title=o+" | Maxim Elchaninov — System Game Designer")}else document.title="Maxim Elchaninov — System Game Designer";if(s){const o=n.t(s);if(o){const r=document.querySelector('meta[name="description"]');r&&r.setAttribute("content",o)}}}destroy(){this.unsubscribe&&this.unsubscribe(),this.checkInterval&&clearInterval(this.checkInterval),this.languageButton&&this.languageButton.removeEventListener("click",()=>this.toggleLanguage())}}class m{constructor(){this.themeButton=null,this.documentElement=document.documentElement}init(){if(this.themeButton=document.querySelector(".header-theme"),!this.themeButton){console.warn("Theme button not found");return}const{moonIcon:i,sunIcon:t}=this.getIcons();if(!i||!t){console.warn("Theme icons not found",{moonIcon:i,sunIcon:t});return}this.themeButton.addEventListener("click",()=>this.toggleTheme());const e=localStorage.getItem("theme")||"dark";this.applyTheme(e)}getIcons(){if(!this.themeButton)return{moonIcon:null,sunIcon:null};const i=this.themeButton.querySelector(".theme-icon-moon"),t=this.themeButton.querySelector(".theme-icon-sun");return{moonIcon:i,sunIcon:t}}applyTheme(i){const{moonIcon:t,sunIcon:e}=this.getIcons();if(!t||!e){console.warn("Theme icons not found",{moonIcon:t,sunIcon:e});return}this.documentElement.setAttribute("data-theme",i);const s=i==="dark"?e:t,o=i==="dark"?t:e;t.style.removeProperty("opacity"),t.style.removeProperty("visibility"),t.style.removeProperty("display"),e.style.removeProperty("opacity"),e.style.removeProperty("visibility"),e.style.removeProperty("display"),t.classList.remove("active"),e.classList.remove("active"),t.offsetHeight,e.offsetHeight,o.style.setProperty("opacity","0","important"),o.style.setProperty("visibility","hidden","important"),s.classList.add("active"),s.style.setProperty("opacity","1","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("display","flex","important")}toggleTheme(){const t=(this.documentElement.getAttribute("data-theme")||"dark")==="light"?"dark":"light";localStorage.setItem("theme",t),this.applyTheme(t)}}export{h as C,g as L,m as T};
