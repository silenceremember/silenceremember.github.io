import{B as p}from"./page-base-page-CSGblTmO.js";import{C as g}from"./factories-BbPh88Zm.js";import{P as u,b as f}from"./managers-BcZlKcHk.js";import{c as h,P as j,l as s,g as m}from"./utils-BGwBK1z0.js";import"./components-scroll-DF6W2z7Q.js";import"./layout-B_i5Hhw_.js";import"./components-core-DxJLR8x9.js";import"./services-ERvBTkKF.js";import"./components-svg-y7IOwReE.js";class k extends p{constructor(){super({navigationSelector:".projects-navigation",imageSelector:".project-card-image"}),this.filtersManager=null,this.groupingManager=null,this.projectCardTemplate=null,this.allProjects=[],this.allProjectCards=new Map}async loadProjectTemplate(){return this.projectCardTemplate||(this.projectCardTemplate=await this.loadPageTemplate("/components/project-card.html",".project-card")),this.projectCardTemplate}async loadProjectsData(){const t=await this.loadPageDataArray("/data/projects.json","projects",[]);return this.autoSetComingSoon(t)}autoSetComingSoon(t){return t.map(e=>e.comingSoon===!0||e.comingSoon===!1||e.links&&typeof e.links=="object"&&Object.keys(e.links).length>0&&Object.values(e.links).some(r=>r&&typeof r=="string"&&r.trim().length>0)?e:{...e,comingSoon:!0})}openProjectDetails(t){if(!t.comingSoon){if(t.links&&t.links.site){window.open(t.links.site,"_blank","noopener,noreferrer");return}if(t.links&&Object.keys(t.links).length>0){const e=Object.values(t.links)[0];if(e){window.open(e,"_blank","noopener,noreferrer");return}}}}async initFilters(t){this.filtersManager?(this.filtersManager.projects=t,this.filtersManager.allProjectCards=this.allProjectCards):this.filtersManager=new u(t,this.allProjectCards,{onCardClick:e=>this.openProjectDetails(e),onRenderGrouped:()=>this.renderGroupedProjects(),onHideLoading:()=>this.loadingIndicator.hide(),onExpandedSectionsClear:()=>{this.groupingManager&&this.groupingManager.expandedSections.clear()}}),await this.filtersManager.init(t)}async renderGroupedProjects(){if(!this.groupingManager){console.warn("Менеджер группировки не инициализирован");return}await this.groupingManager.renderGroupedProjects()}async createProjectCardsBatched(t,e=10){return new Promise(o=>{let r=0;const n=()=>{const d=Math.min(r+e,t.length);for(let c=r;c<d;c++){const l=t[c],a=g.createProjectCard(this.projectCardTemplate,l,i=>this.openProjectDetails(i));a&&this.allProjectCards.set(l.id,a)}r=d,r<t.length?window.requestIdleCallback?requestIdleCallback(n,{timeout:100}):setTimeout(n,0):o()};n()})}async init(){await this.initBase(),this.initLoadingIndicator("projects-loading","projects-loading-container"),this.loadingIndicator.show();const[t]=await Promise.all([this.loadProjectsData(),this.loadProjectTemplate()]),e=this.loadingIndicator.hide();if(t.length===0)return;this.allProjects=t,await Promise.all([e,this.createProjectCardsBatched(t)]),this.groupingManager?(this.groupingManager.projects=this.allProjects,this.groupingManager.allProjectCards=this.allProjectCards):this.groupingManager=new f(this.allProjects,this.allProjectCards,{onCardClick:r=>this.openProjectDetails(r),onHideLoading:()=>this.loadingIndicator.hide()});const[o]=await Promise.all([this.renderGroupedProjects(),this.initFilters(t)]);requestAnimationFrame(()=>{h.loadAllImages()}),await j.waitForFontsLoaded(),this.languageChangeHandler=()=>{this.updateContentLanguage()},this.updateContentLanguage(),window.addEventListener("languageChanged",this.languageChangeHandler)}updateContentLanguage(){if(document.querySelectorAll(".project-card").forEach(t=>{const e=t.getAttribute("data-project-id");if(!e)return;const o=this.allProjects.find(i=>i.id===e);if(!o)return;const r=t.querySelector(".project-card-title");if(r){const i=s.getCurrentLanguage();o.titleLocalized&&o.titleLocalized[i]?r.textContent=o.titleLocalized[i]:r.textContent=o.title}const n=t.querySelector(".project-card-description");if(n){const i=s.getCurrentLanguage();o.descriptionLocalized&&o.descriptionLocalized[i]?n.textContent=o.descriptionLocalized[i]:n.textContent=o.description||""}const d=t.querySelector(".project-card-status");if(d){const i=o.status==="completed"?"completed":"inDevelopment";d.textContent=s.t(`projects.filters.statuses.${i}`)}const c=t.querySelector(".project-card-type");if(c&&o.type){const i={game:s.t("projects.card.types.game"),document:s.t("projects.card.types.document"),tool:s.t("projects.card.types.tool"),script:s.t("projects.card.types.script")};c.textContent=i[o.type]||o.type}const l=t.querySelector(".project-card-role");l&&(l.textContent=m(o.role,!1,o.teamName));const a=t.querySelector(".project-card-button");if(a)if(o.comingSoon)a.textContent=s.t("projects.card.comingSoon"),a.setAttribute("aria-label",s.t("projects.card.comingSoonAria"));else{const i=a.querySelector("span[data-i18n]");i?i.textContent=s.t("projects.card.details"):a.textContent=s.t("projects.card.details"),a.setAttribute("aria-label",s.t("projects.card.detailsAria"))}}),this.filtersManager){const t=document.querySelector(".project-filters-content");t&&t.querySelectorAll(".project-filters-group").forEach((n,d)=>{const c=n.querySelector(".project-filters-group-title");if(c){const l=n.querySelector("[data-filter]");if(l){const a=l.getAttribute("data-filter"),i={category:"projects.filters.category",status:"projects.filters.status",year:"projects.filters.year"};i[a]&&(c.textContent=s.t(i[a]))}else{const a=c.getAttribute("data-i18n");a&&(c.textContent=s.t(a))}}}),document.querySelectorAll(".project-filters-group-title").forEach(r=>{const n=r.getAttribute("data-i18n");n&&(r.textContent=s.t(n))}),document.querySelectorAll(".project-filters-option-label").forEach(r=>{var d;const n=r.getAttribute("data-i18n");if(n)r.textContent=s.t(n);else{const c=r.closest(".project-filters-option");if(c){const l=c.getAttribute("data-value"),a=(d=c.closest("[data-filter]"))==null?void 0:d.getAttribute("data-filter");if(a==="category"){const i={games:"projects.filters.categories.games",tools:"projects.filters.categories.tools",research:"projects.filters.categories.research"};i[l]&&(r.textContent=s.t(i[l]))}else if(a==="status"){const i={completed:"projects.filters.statuses.completed","in-development":"projects.filters.statuses.inDevelopment"};i[l]&&(r.textContent=s.t(i[l]))}}}});const e=document.getElementById("project-filters-reset");if(e){const r=e.querySelector(".projects-section-expand-text");r&&(r.textContent=s.t("projects.filters.reset")),e.setAttribute("aria-label",s.t("projects.filters.resetAria"))}const o=document.querySelector("#project-filters-results .projects-section-title-text");o&&(o.textContent=s.t("projects.filters.found"))}if(this.groupingManager){const t={games:s.t("projects.filters.categories.games"),tools:s.t("projects.filters.categories.tools"),research:s.t("projects.filters.categories.research")};document.querySelectorAll(".projects-section-title-text").forEach(e=>{const o=e.closest(".projects-section");if(o){const r=o.getAttribute("data-category");r&&t[r]&&(e.textContent=t[r])}}),document.querySelectorAll(".projects-section-expand-text").forEach(e=>{const o=e.closest(".projects-section-expand");o&&o.getAttribute("aria-expanded")==="true"?e.textContent=s.t("projects.filters.hide"):o&&(e.textContent=s.t("projects.filters.showAll"))})}}cleanup(){var t;this.languageChangeHandler&&window.removeEventListener("languageChanged",this.languageChangeHandler),(t=super.cleanup)==null||t.call(this)}}export{k as ProjectsPage};
