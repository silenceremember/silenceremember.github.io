import{B as b}from"./page-base-page-CSGblTmO.js";import{C as f}from"./factories-BbPh88Zm.js";import{D as m,l as o,d as g,b as x,a as A,S as C}from"./utils-BGwBK1z0.js";import"./components-scroll-DF6W2z7Q.js";import"./layout-B_i5Hhw_.js";import"./components-core-DxJLR8x9.js";import"./services-ERvBTkKF.js";class F extends b{constructor(){super({navigationSelector:".research-navigation",imageSelector:".research-card img"}),this.researchCardTemplate=null,this.publications=[]}async loadResearchTemplate(){return this.researchCardTemplate||(this.researchCardTemplate=await this.loadPageTemplate("/components/research-card.html",".research-card")),this.researchCardTemplate}async loadResearchData(){return this.loadPageDataArray("/data/research.json","publications",[])}groupPublicationsByYear(d){const t={};return d.forEach(s=>{const l=m.getYearFromDate(s.date);l&&(t[l]||(t[l]=[]),t[l].push(s))}),t}async init(){await this.initBase(),this.languageChangeHandler=()=>{this.updateContentLanguage()},window.addEventListener("languageChanged",this.languageChangeHandler),this.initLoadingIndicator("research-loading","research-loading-container"),this.loadingIndicator.show(),await this.loadResearchTemplate();const d=await this.loadResearchData();this.publications=d,await this.loadingIndicator.hide();const t=document.getElementById("research-publications-section"),s=document.getElementById("research-diploma-section");if(t&&(t.style.visibility="visible",(!t.style.opacity||t.style.opacity==="")&&(t.style.opacity="0")),s&&(s.style.visibility="visible",(!s.style.opacity||s.style.opacity==="")&&(s.style.opacity="0")),d.length===0){if(t){t.innerHTML=`<p>${o.t("research.errors.noPublications")}</p>`;const a=t.style.opacity;(a==="0"||!a||a==="")&&(t.style.transition="opacity 0.3s ease-in-out",t.style.opacity="1",setTimeout(()=>{t.style.opacity="",t.style.transition=""},300)),t.style.visibility=""}return}const l=d.find(a=>a.type==="diploma"),h=d.filter(a=>a.type!=="diploma");if(l&&s){const a=document.createElement("h2");a.className="research-section-title",a.textContent=o.t("research.diploma.title"),s.appendChild(a);const i=document.createElement("div");i.className="research-grid research-grid-diploma";const e=f.createResearchCard(this.researchCardTemplate,l);e&&(e.style.opacity="0",e.style.transform="translateY(10px)",e.style.transition="none",i.appendChild(e)),s.appendChild(i),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const r=s.style.opacity;(r==="0"||!r||r==="")&&g(s),e&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{x(e)})})})})}h.sort((a,i)=>{var n,u;const e=m.getYearFromDate(a.date)||0,r=m.getYearFromDate(i.date)||0;return r!==e?r-e:(n=a.date)!=null&&n.start&&((u=i.date)!=null&&u.start)?new Date(i.date.start)-new Date(a.date.start):0});const p=this.groupPublicationsByYear(h),c=Object.keys(p).sort((a,i)=>parseInt(i)-parseInt(a));if(t&&c.length>0)c.forEach(a=>{const i=document.createElement("h2");i.className="research-year-header",i.textContent=a,t.appendChild(i);const e=document.createElement("div");e.className="research-grid",p[a].forEach(r=>{const n=f.createResearchCard(this.researchCardTemplate,r);n&&(n.style.opacity="0",n.style.transform="translateY(10px)",n.style.transition="none",e.appendChild(n))}),t.appendChild(e)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const a=t.style.opacity;(a==="0"||!a||a==="")&&g(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const i=t.querySelectorAll(".research-card");i.length>0&&A(i)})})})});else if(t){const a=t.style.opacity;(a==="0"||!a||a==="")&&g(t)}s&&!l&&s.style.opacity==="0"&&s.children.length===0&&(s.style.visibility="hidden"),await this.waitForPageReady(),this.updateContentLanguage()}updateContentLanguage(){const d=document.querySelector("#research-diploma-section .research-section-title");d&&(d.textContent=o.t("research.diploma.title")),document.querySelectorAll(".research-card").forEach(t=>{const s=t.querySelector(".research-card-title");if(s){const i=t.getAttribute("data-research-id");if(i&&this.publications){const e=this.publications.find(r=>r.id===i);if(e){const r=o.getCurrentLanguage();e.titleLocalized&&e.titleLocalized[r]?s.textContent=e.titleLocalized[r]:s.textContent=e.title}}}const l=t.querySelector(".research-card-journal");if(l){const i=t.getAttribute("data-research-id");if(i&&this.publications){const e=this.publications.find(r=>r.id===i);if(e&&e.journal){const r=o.getCurrentLanguage();let n="";if(e.journalLocalized&&e.journalLocalized[r]?n=e.journalLocalized[r]:n=e.journal,e.location){const u=e.locationLocalized&&e.locationLocalized[r]?e.locationLocalized[r]:e.location;n+=` (${u})`}l.textContent=n}}}const h=t.querySelector(".research-card-keywords");if(h){const i=t.getAttribute("data-research-id");if(i&&this.publications){const e=this.publications.find(r=>r.id===i);if(e&&e.keywords&&e.keywords.length>0){const r=o.getCurrentLanguage(),n=e.keywordsLocalized&&e.keywordsLocalized[r]?e.keywordsLocalized[r]:e.keywords;h.innerHTML="",n.forEach(u=>{const y=document.createElement("span");y.className="research-card-keyword",y.textContent=u,h.appendChild(y)})}}}const p=t.querySelector(".research-card-type");if(p){const i=t.getAttribute("data-research-id");if(i&&this.publications){const e=this.publications.find(r=>r.id===i);e&&(p.textContent=C.getTypeText(e.type))}else{const e=t.getAttribute("data-type");e&&(p.textContent=C.getTypeText(e))}}const c=t.querySelector(".research-card-button");if(c){const i=t.getAttribute("data-research-id");if(i&&this.publications){const e=this.publications.find(r=>r.id===i);if(e)if(e.links&&Object.keys(e.links).length>0&&Object.values(e.links).some(n=>n&&typeof n=="string"&&n.trim().length>0)){const n=c.querySelector("span[data-i18n]")||c;n.textContent&&(n.textContent=o.t("research.card.read")),c.setAttribute("aria-label",o.t("research.card.readAria")),c.disabled=!1}else c.textContent=o.t("research.card.comingSoon"),c.setAttribute("aria-label",o.t("research.card.comingSoonAria")),c.disabled=!0}else{const e=c.querySelector("span[data-i18n]")||c;e.textContent&&(e.textContent=o.t("research.card.read")),c.setAttribute("aria-label",o.t("research.card.readAria"))}}const a=t.querySelector(".research-card-level");if(a&&a.textContent){const i=a.textContent.trim();i==="РИНЦ"||i==="RSCI"?(o.getCurrentLanguage(),a.textContent=o.t("research.levels.RSCI")):i==="Scopus"&&(a.textContent=o.t("research.levels.Scopus"))}})}destroy(){this.languageChangeHandler&&window.removeEventListener("languageChanged",this.languageChangeHandler)}}export{F as ResearchPage};
