import{a as b,b as S,l as w,c as P,A,d as x}from"./utils-BGwBK1z0.js";import{L as k}from"./layout-B_i5Hhw_.js";import{SvgLoader as F}from"./components-svg-y7IOwReE.js";class ${constructor(e){if(!e)throw new Error("slidesContainer is required");this.slidesContainer=e,this.lastKnownMode=null,this.animationTimeout=null,this.isAnimating=!1,this.debounceTimeout=null,this.lastActiveSlideIndex=null,this.slideAnimationTimeout=null,this.isModeSwitching=!1,this.slideObserver=null,this.containerObserver=null}initializeFirstSlideAnimation(){if(!this.slidesContainer){this.setupSlideAnimations();return}const e=this.slidesContainer.classList.contains("tablet-scroll-mode"),t=this.slidesContainer.querySelectorAll(".slide");t.forEach(s=>{this.hideSlideElementsBeforeAnimation(s)}),t.length>0&&t[0].firstElementChild&&t[0].firstElementChild.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.forEach(s=>{const o=parseInt(s.getAttribute("data-slide"));let i=[];o===0?i=s.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text, .portrait-image"):o===4?i=s.querySelectorAll(".section-title, .cta-button, .cta-divider"):i=s.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder"),i.forEach(a=>{if(a){const n=window.getComputedStyle(a);parseFloat(n.opacity)>.01&&(a.style.setProperty("opacity","0","important"),a.style.setProperty("transform","translateY(10px)","important"),a.style.setProperty("transition","none","important"))}})}),setTimeout(()=>{e?this.lastKnownMode===null&&(this.lastKnownMode=e,this.restartAnimationsOnModeChange()):(this.lastKnownMode===null&&(this.lastKnownMode=e),this.lastActiveSlideIndex===null&&(this.lastActiveSlideIndex=0,this.animateFirstSlide())),this.setupSlideAnimations()},100)})})}animateFirstSlide(){const e=this.slidesContainer.querySelector('.slide[data-slide="0"]');e&&this.animateSlideContent(e)}restartAnimationsOnModeChange(){if(!this.slidesContainer)return;const e=this.slidesContainer.classList.contains("tablet-scroll-mode");this.isAnimating&&this.animationTimeout&&(clearTimeout(this.animationTimeout),this.animationTimeout=null),this.isAnimating=!0;const t=this.slidesContainer.querySelectorAll(".slide");this.animationTimeout=setTimeout(()=>{if(e){const s=[];t.forEach(i=>{const a=window.getComputedStyle(i);if(a.opacity!=="0"&&a.visibility!=="hidden"){const n=parseInt(i.getAttribute("data-slide"));if(n===0){const r=i.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text"),c=i.querySelector(".portrait-image");s.push(...Array.from(r)),c&&s.push(c)}else if(n===4){const r=i.querySelector(".section-title"),c=i.querySelectorAll(".cta-button"),d=i.querySelector(".cta-divider");r&&s.push(r),s.push(...Array.from(c)),d&&s.push(d)}else{const r=i.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder");s.push(...Array.from(r))}}});const o=s.filter(i=>{if(!i)return!1;const a=window.getComputedStyle(i),n=parseFloat(a.opacity),r=i.style.opacity,c=i.style.transform;return!(n>=.99&&(!r||r===""||r==="1")&&(!c||c===""||c.includes("translateY(0")))});o.length>0&&(o.forEach(i=>{i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important")}),o.length>0&&o[0]&&o[0].offsetHeight),o.length>0?requestAnimationFrame(()=>{requestAnimationFrame(()=>{b(o,{skipInitialState:!0})})}):(this.isAnimating=!1,this.animationTimeout=null)}else{const s=this.slidesContainer.querySelector(".slide.active");s&&(this.hideSlideElementsBeforeAnimation(s),s.firstElementChild&&s.firstElementChild.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.animateSlideContent(s)})}))}setTimeout(()=>{this.isAnimating=!1,this.animationTimeout=null},500)},50)}setupSlideAnimations(){if(!this.slidesContainer)return;this.slideObserver=new MutationObserver(t=>{t.forEach(s=>{if(s.type==="attributes"&&s.attributeName==="class"){const o=s.target;if(o.classList.contains("active")&&o.classList.contains("slide")){const i=parseInt(o.getAttribute("data-slide"));if(this.lastActiveSlideIndex===i&&this.lastActiveSlideIndex!==null)return;if(this.isModeSwitching){this.lastActiveSlideIndex=i,this.showActiveSlideElements();return}this.slideAnimationTimeout&&(clearTimeout(this.slideAnimationTimeout),this.slideAnimationTimeout=null),this.lastActiveSlideIndex=i,this.slideAnimationTimeout=setTimeout(()=>{this.animateSlideContent(o),this.slideAnimationTimeout=null},100)}}})}),this.slidesContainer.querySelectorAll(".slide").forEach(t=>{this.slideObserver.observe(t,{attributes:!0,attributeFilter:["class"]})}),this.containerObserver=new MutationObserver(t=>{t.forEach(s=>{if(s.type==="attributes"&&s.attributeName==="class"&&s.target===this.slidesContainer){const i=this.slidesContainer.classList.contains("tablet-scroll-mode"),a=this.lastKnownMode!==i;if(a&&i===!1&&this.lastKnownMode===!0){this.isModeSwitching=!0,this.slideAnimationTimeout&&(clearTimeout(this.slideAnimationTimeout),this.slideAnimationTimeout=null),this.lastKnownMode=i,this.showActiveSlideElements(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.showActiveSlideElements(),setTimeout(()=>{this.isModeSwitching=!1},500)})});return}if(a&&i===!0){this.isModeSwitching=!0,this.lastKnownMode=i,requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.showAllSlideElements(),setTimeout(()=>{this.isModeSwitching=!1},200)})});return}a&&(this.lastKnownMode=i)}})}),this.containerObserver.observe(this.slidesContainer,{attributes:!0,attributeFilter:["class"]}),this.lastKnownMode=this.slidesContainer.classList.contains("tablet-scroll-mode")}showAllSlideElements(){this.slidesContainer.querySelectorAll(".slide").forEach(t=>{const s=parseInt(t.getAttribute("data-slide"));let o=[];s===0?o=t.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text, .portrait-image"):s===4?o=t.querySelectorAll(".section-title, .cta-button, .cta-divider"):o=t.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder"),o.forEach(i=>{i&&(i.style.removeProperty("opacity"),i.style.removeProperty("transform"),i.style.removeProperty("transition"))})})}showActiveSlideElements(){const e=this.slidesContainer.querySelector(".slide.active");if(!e)return;const t=parseInt(e.getAttribute("data-slide"));let s=[];t===0?s=e.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text, .portrait-image"):t===4?s=e.querySelectorAll(".section-title, .cta-button, .cta-divider"):s=e.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder"),s.forEach(o=>{o&&(o.style.removeProperty("opacity"),o.style.removeProperty("transform"),o.style.removeProperty("transition"))})}hideSlideElementsBeforeAnimation(e){const t=parseInt(e.getAttribute("data-slide"));if(t===0){e.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text, .portrait-image").forEach(i=>{i&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important"))});return}if(t===4){e.querySelectorAll(".section-title, .cta-button, .cta-divider").forEach(i=>{i&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important"))});return}e.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder").forEach(o=>{o&&(o.style.setProperty("opacity","0","important"),o.style.setProperty("transform","translateY(10px)","important"),o.style.setProperty("transition","none","important"))})}animateSlideContent(e){if(this.isModeSwitching)return;const t=parseInt(e.getAttribute("data-slide"));this.hideSlideElementsBeforeAnimation(e),e.firstElementChild&&e.firstElementChild.offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{if(t===0){const i=[".main-content-name",".main-content-tagline",".main-content-title",".cv-about-text"];i.forEach((n,r)=>{const c=e.querySelector(n);c&&setTimeout(()=>{S(c,{skipInitialState:!0})},r*30)});const a=e.querySelector(".portrait-image");a&&setTimeout(()=>{S(a,{skipInitialState:!0})},i.length*30);return}if(t===4){const i=e.querySelector(".section-title"),a=e.querySelectorAll(".cta-button"),n=e.querySelector(".cta-divider");i&&S(i,{skipInitialState:!0}),a.length>0&&setTimeout(()=>{a.forEach((r,c)=>{setTimeout(()=>{S(r,{skipInitialState:!0})},c*30)})},50),n&&setTimeout(()=>{S(n,{skipInitialState:!0})},100+a.length*30);return}const s=[".section-title",".project-title",".project-meta",".project-placeholder",".details-block"];s.forEach((i,a)=>{const n=e.querySelectorAll(i);n.length>0&&setTimeout(()=>{n.forEach(r=>{S(r,{skipInitialState:!0})})},a*30)});const o=e.querySelectorAll(".preview-placeholder");o.length>0&&setTimeout(()=>{o.forEach(i=>{S(i,{skipInitialState:!0})})},s.length*30)},50)})})}hideAllSlideElementsImmediately(){if(!this.slidesContainer)return;this.slidesContainer.querySelectorAll(".slide").forEach(t=>{const s=parseInt(t.getAttribute("data-slide"));let o=[];s===0?o=t.querySelectorAll(".main-content-name, .main-content-tagline, .main-content-title, .cv-about-text, .portrait-image"):s===4?o=t.querySelectorAll(".section-title, .cta-button, .cta-divider"):o=t.querySelectorAll(".section-title, .project-title, .project-meta, .project-placeholder, .details-block, .preview-placeholder"),o.forEach(i=>{i&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important"))})})}}const B=new k,N=T=>B.loadHTML(T);class D{constructor(e,t,s={}){this.projects=e,this.allProjectCards=t,this.onCardClick=s.onCardClick||(()=>{}),this.onRenderGrouped=s.onRenderGrouped||(async()=>{}),this.onHideLoading=s.onHideLoading||(async()=>{}),this.onExpandedSectionsClear=s.onExpandedSectionsClear||(()=>{}),this.activeFilters={category:[],status:[],year:[]},this.savedYearButtonWidth=null,this.projectFiltersTemplate=null,this.isApplyingFilters=!1}async init(e){e&&(this.projects=e);const t=document.getElementById("projects-filters-container");if(!t)return;if(!this.projectFiltersTemplate)try{this.projectFiltersTemplate=await N("/components/project-filters.html")}catch(i){console.error("Ошибка загрузки шаблона фильтров:",i);return}const s=t.querySelector("#project-filters-year-button");s&&s.style.width&&(this.savedYearButtonWidth=s.style.width),[...new Set(this.projects.map(i=>i.category))],[...new Set(this.projects.map(i=>i.status))];const o=[...new Set(this.projects.map(i=>i.year).filter(Boolean).sort((i,a)=>a-i))];if(this.projectFiltersTemplate){t.innerHTML=this.projectFiltersTemplate;const i=t.querySelector(".project-filters-content");i&&(i.style.opacity="0",i.style.transform="translateY(10px)",i.style.transition="none",i.offsetHeight);const a={};this.projects.forEach(d=>{d.year&&(a[d.year]=(a[d.year]||0)+1)});const n=t.querySelector("#project-filters-year-dropdown-menu"),r=t.querySelector("#project-filters-year-button");let c=!1;if(n){const d=document.createElement("button");if(d.className="project-filters-year-option project-filters-year-option-dash",d.type="button",d.setAttribute("data-value",""),d.innerHTML=`
          <span class="project-filters-year-option-label">—</span>
          <span class="project-filters-year-option-count" style="display: none;"></span>
        `,n.appendChild(d),o.forEach(m=>{const l=document.createElement("button");l.className="project-filters-year-option",l.type="button",l.setAttribute("data-value",m.toString()),l.innerHTML=`
            <span class="project-filters-year-option-label">${m}</span>
            <span class="project-filters-year-option-count">${a[m]||0}</span>
          `,n.appendChild(l)}),r){let m=!0;if(this.savedYearButtonWidth&&parseFloat(this.savedYearButtonWidth)>0&&(r.style.width=this.savedYearButtonWidth,r.style.minWidth=this.savedYearButtonWidth,r.style.maxWidth=this.savedYearButtonWidth,n.style.width=this.savedYearButtonWidth,(window.innerWidth<1024||window.innerHeight<900)&&(n.style.setProperty("width",this.savedYearButtonWidth,"important"),n.style.setProperty("min-width","0","important")),m=!1),m){const l=()=>new Promise(y=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{const g=r.style.width,E=n.style.width;r.style.width="",n.style.width="";const u=document.createElement("div");u.style.position="absolute",u.style.visibility="hidden",u.style.top="-9999px",u.style.left="-9999px",u.style.display="flex",u.style.flexDirection="column",u.style.width="auto",u.style.height="auto",u.style.overflow="visible",document.body.appendChild(u);const f=n.cloneNode(!0);f.hidden=!1,f.style.display="flex",f.style.flexDirection="column",f.style.visibility="visible",f.style.position="static",f.style.width="auto",f.style.minWidth="auto",f.style.maxWidth="none",f.style.maxHeight="none",f.style.overflow="visible",u.appendChild(f);const h=f.querySelectorAll(".project-filters-year-option");let C=0;if(h.length===0){document.body.removeChild(u),r.style.width=g,n.style.width=E,y(0);return}h.forEach(v=>{const q=v.style.width,I=v.style.display;v.style.width="auto",v.style.display="flex";const j=v.getBoundingClientRect().width;v.style.width=q,v.style.display=I,j>C&&(C=j)}),document.body.removeChild(u),r.style.width=g,n.style.width=E,y(C)})})}),p=y=>{y>0&&(r.style.width=`${y}px`,r.style.minWidth=`${y}px`,r.style.maxWidth=`${y}px`,n.style.width=`${y}px`,(window.innerWidth<1024||window.innerHeight<900)&&(n.style.setProperty("width",`${y}px`,"important"),n.style.setProperty("min-width","0","important")),this.savedYearButtonWidth=`${y}px`)};requestAnimationFrame(()=>{requestAnimationFrame(()=>{setTimeout(()=>{l().then(y=>{p(y),i&&!c&&(c=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{S(i)})}))})},50)})})}else i&&!c&&(c=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{S(i)})}))}else i&&!c&&(c=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{S(i)})}))}else i&&!c&&(c=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{S(i)})}))}this.updateFilterCounts(this.projects),this.initFilterButtons(),this.initYearDropdown()}updateFilterCounts(e){const t={},s={};e.forEach(o=>{t[o.category]=(t[o.category]||0)+1,s[o.status]=(s[o.status]||0)+1}),document.querySelectorAll(".project-filters-option").forEach(o=>{const i=o.getAttribute("data-value"),a=o.querySelector(".project-filters-option-count");if(!a)return;const n=o.closest("[data-filter]");if(!n)return;const r=n.getAttribute("data-filter");let c=0;r==="category"?c=t[i]||0:r==="status"&&(c=s[i]||0),a.textContent=c})}initFilterButtons(){document.querySelectorAll(".project-filters-option").forEach(s=>{s.addEventListener("click",()=>{const o=s.closest("[data-filter]");if(!o)return;const i=o.getAttribute("data-filter"),a=s.getAttribute("data-value");i&&a&&this.toggleFilter(i,a,s)})});const t=document.getElementById("project-filters-reset");t&&t.addEventListener("click",()=>{this.clearAllFilters()})}initYearDropdown(){const e=document.getElementById("project-filters-year-button"),t=document.getElementById("project-filters-year-dropdown-menu");if(!e||!t){console.warn("Dropdown элементы не найдены");return}e.addEventListener("click",i=>{i.stopPropagation();const n=!(e.getAttribute("aria-expanded")==="true");e.setAttribute("aria-expanded",n),n?(t.hidden=!1,t.style.top="",t.style.left="",t.style.opacity="0",requestAnimationFrame(()=>{t.style.transition="opacity 0.15s ease-in-out",t.style.opacity="1"})):(t.style.transition="opacity 0.15s ease-in-out",t.style.opacity="0",setTimeout(()=>{t.hidden=!0,t.style.opacity="",t.style.transition=""},150))});const s=i=>{!e.contains(i.target)&&!t.contains(i.target)&&(e.setAttribute("aria-expanded","false"),t.style.transition="opacity 0.15s ease-in-out",t.style.opacity="0",setTimeout(()=>{t.hidden=!0,t.style.opacity="",t.style.transition=""},150))};document.addEventListener("click",s,!0);const o=i=>{const a=i.getAttribute("data-value"),n=i.querySelector(".project-filters-year-option-label"),r=i.querySelector(".project-filters-year-option-count"),c=n?n.textContent.trim():a,d=r&&r.style.display!=="none"?r.textContent.trim():"0",m=e.querySelector(".project-filters-year-button-label"),l=e.querySelector(".project-filters-year-button-count");e.setAttribute("aria-expanded","false"),t.style.transition="opacity 0.15s ease-in-out",t.style.opacity="0",setTimeout(()=>{t.hidden=!0,t.style.opacity="",t.style.transition=""},150),!a||a===""||this.activeFilters.year.length>0&&this.activeFilters.year[0]===a?(this.activeFilters.year=[],m&&(m.textContent="—"),l&&(l.textContent="0",l.style.display="none"),e.classList.remove("has-count")):(this.activeFilters.year=[a],m&&(m.textContent=c),l&&(l.textContent=d,l.style.display="flex"),e.classList.add("has-count")),this.applyFilters()};t.addEventListener("click",i=>{const a=i.target.closest(".project-filters-year-option");a&&(i.stopPropagation(),o(a))})}toggleFilter(e,t,s){this.activeFilters[e]||(this.activeFilters[e]=[]);const o=this.activeFilters[e].indexOf(t);o!==-1?(this.activeFilters[e].splice(o,1),s.setAttribute("aria-pressed","false"),s.classList.remove("active")):(this.activeFilters[e].push(t),s.setAttribute("aria-pressed","true"),s.classList.add("active")),this.applyFilters()}clearAllFilters(){this.activeFilters={category:[],status:[],year:[]},document.querySelectorAll(".project-filters-option").forEach(s=>{s.setAttribute("aria-pressed","false"),s.classList.remove("active")});const e=document.getElementById("project-filters-year-button"),t=document.getElementById("project-filters-year-dropdown-menu");if(e){const s=e.querySelector(".project-filters-year-button-label"),o=e.querySelector(".project-filters-year-button-count");s&&(s.textContent="—"),o&&(o.textContent="0",o.style.display="none"),e.classList.remove("has-count"),e.setAttribute("aria-expanded","false")}t&&(t.style.transition="opacity 0.15s ease-in-out",t.style.opacity="0",setTimeout(()=>{t.hidden=!0,t.style.opacity="",t.style.transition=""},150)),this.applyFilters()}async applyFilters(){const e=document.getElementById("projects-grid");if(e&&!this.isApplyingFilters){this.isApplyingFilters=!0;try{if(!Object.values(this.activeFilters).some(p=>p.length>0)){this.onExpandedSectionsClear();const p=document.getElementById("projects-loading");if(p){const y=window.getComputedStyle(p);y.display!=="none"&&y.visibility!=="hidden"&&parseFloat(y.opacity)>.01&&await this.onHideLoading()}await this.onRenderGrouped();return}document.getElementById("projects-loading")&&await this.onHideLoading(),e.innerHTML="",e.className="projects-grid";const o=document.createElement("div");o.className="projects-section";const i=document.createElement("div");i.className="projects-section-header";const a=document.createElement("h2");a.className="projects-section-title",a.id="project-filters-results";const n=document.createElement("span");n.className="projects-section-title-text",n.textContent=w.t("projects.filters.found"),a.appendChild(n);const r=document.createElement("span");r.className="project-filters-option-count",r.textContent="0",a.appendChild(r);const c=document.createElement("button");c.className="projects-section-expand",c.id="project-filters-reset",c.setAttribute("aria-label",w.t("projects.filters.resetAria"));const d=document.createElement("span");d.className="projects-section-expand-text",d.textContent=w.t("projects.filters.reset"),c.appendChild(d),c.addEventListener("click",()=>{this.clearAllFilters()}),a.appendChild(c),i.appendChild(a),o.appendChild(i);const m=document.createElement("div");m.className="projects-section-grid";let l=0;this.projects.forEach(p=>{let y=!0;if(y&&this.activeFilters.category.length>0&&(this.activeFilters.category.includes(p.category)||(y=!1)),y&&this.activeFilters.status.length>0&&(this.activeFilters.status.includes(p.status)||(y=!1)),y&&this.activeFilters.year.length>0&&p.year&&!this.activeFilters.year.includes(p.year.toString())&&(y=!1),y){let g=null;const E=this.allProjectCards.get(p.id);if(E){g=E.cloneNode(!0),g.style.opacity="0",g.style.transform="translateY(10px)",g.style.transition="none",g.addEventListener("click",f=>{const h=window.getSelection();h&&h.toString().trim().length>0||(f.stopPropagation(),p.comingSoon||this.onCardClick(p))});const u=g.querySelector(".project-card-button");u&&u.addEventListener("click",f=>{f.stopPropagation(),p.comingSoon||this.onCardClick(p)})}if(g){m.appendChild(g);const u=g.querySelector("img[data-src]");u&&P.loadImage(u),l++}}}),r.textContent=l,o.appendChild(m),e.appendChild(o),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const p=m.querySelectorAll(".project-card");p.length>0&&b(p)})}),requestAnimationFrame(async()=>{try{await new F().init()}catch(p){console.error("Ошибка загрузки SVG:",p)}})}finally{this.isApplyingFilters=!1}}}}class W{constructor(e,t,s={}){this.projects=e||[],this.allProjectCards=t||new Map,this.onCardClick=s.onCardClick||(()=>{}),this.onHideLoading=s.onHideLoading||(()=>Promise.resolve()),this.expandedSections=new Set,this.isRendering=!1,this.activeTimeouts=new Map,this.isAnimating=new Map,this.CARD_ANIMATION=A}_stopAllAnimations(e){e.forEach(t=>{if(!t||!t.parentNode)return;t.style.setProperty("transition","none","important");const s=window.getComputedStyle(t),o=s.opacity,i=s.transform;t.style.setProperty("opacity",o,"important"),t.style.setProperty("transform",i,"important"),t.offsetHeight})}toggleSectionExpansion(e,t,s){const o=document.querySelector(`[data-category="${e}"]`);if(!o||this.isAnimating.get(e))return;(this.activeTimeouts.get(e)||[]).forEach(r=>{clearTimeout(r)}),this.activeTimeouts.set(e,[]);const a=this.expandedSections.has(e),n=Array.from(o.querySelectorAll('[data-hidden-card="true"], .project-card-hidden')).filter(r=>r&&r.parentNode);if(this.isAnimating.set(e,!0),a){this._stopAllAnimations(n),n.forEach(d=>{d.style.removeProperty("transition"),d.style.removeProperty("opacity"),d.style.removeProperty("transform"),d.style.transition=`opacity ${this.CARD_ANIMATION.duration} ${this.CARD_ANIMATION.timing}, transform ${this.CARD_ANIMATION.duration} ${this.CARD_ANIMATION.timing}`,d.offsetHeight,d.style.opacity="0",d.style.transform=`translateY(${A.translateYDisappear})`});const r=setTimeout(()=>{if(!this.isAnimating.get(e))return;n.forEach(l=>{!l||!l.parentNode||(l.style.display="none",l.style.removeProperty("opacity"),l.style.removeProperty("transform"),l.style.removeProperty("transition"),l.style.removeProperty("visibility"),l.classList.add("project-card-hidden"),l.setAttribute("data-hidden-card","true"))}),this.isAnimating.set(e,!1);const d=this.activeTimeouts.get(e)||[],m=d.indexOf(r);m>-1&&d.splice(m,1)},this.CARD_ANIMATION.timeout),c=this.activeTimeouts.get(e)||[];c.push(r),this.activeTimeouts.set(e,c),this.expandedSections.delete(e),t.setAttribute("aria-expanded","false"),t.querySelector(".projects-section-expand-text").textContent=w.t("projects.filters.showAll")}else this._stopAllAnimations(n),n.forEach(r=>{r.classList.remove("project-card-hidden"),r.setAttribute("data-hidden-card","true"),r.style.display="",r.style.removeProperty("opacity"),r.style.removeProperty("transform"),r.style.removeProperty("transition"),r.style.removeProperty("visibility"),r.style.opacity="0",r.style.transform=`translateY(${A.translateYAppear})`,r.style.transition="none"}),n.length>0&&n[0]&&n[0].offsetHeight,requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.isAnimating.get(e)&&(n.length>0?(n.forEach(r=>{if(!r||!r.parentNode)return;const c=window.getComputedStyle(r);parseFloat(c.opacity)>.01&&(r.style.opacity="0",r.style.transform=`translateY(${A.translateYAppear})`,r.style.transition="none",r.offsetHeight)}),n.length>0&&n[0]&&n[0].offsetHeight,requestAnimationFrame(()=>{if(!this.isAnimating.get(e))return;n.forEach(d=>{!d||!d.parentNode||(d.style.removeProperty("transition"),d.style.transition=`opacity ${this.CARD_ANIMATION.duration} ${this.CARD_ANIMATION.timing}, transform ${this.CARD_ANIMATION.duration} ${this.CARD_ANIMATION.timing}`)}),n.length>0&&n[0]&&n[0].offsetHeight,n.forEach(d=>{!d||!d.parentNode||(d.style.removeProperty("opacity"),d.style.removeProperty("transform"),d.style.opacity="1",d.style.transform=`translateY(${A.translateYFinal})`)});const r=setTimeout(()=>{if(!this.isAnimating.get(e))return;n.forEach(l=>{!l||!l.parentNode||(l.style.removeProperty("transform"),l.style.removeProperty("opacity"),l.style.removeProperty("transition"))}),this.isAnimating.set(e,!1);const d=this.activeTimeouts.get(e)||[],m=d.indexOf(r);m>-1&&d.splice(m,1)},A.timeout),c=this.activeTimeouts.get(e)||[];c.push(r),this.activeTimeouts.set(e,c)})):this.isAnimating.set(e,!1))})}),this.expandedSections.add(e),t.setAttribute("aria-expanded","true"),t.querySelector(".projects-section-expand-text").textContent=w.t("projects.filters.hide")}createSection(e,t,s){const o=t.filter(u=>u.featured),i=t.filter(u=>!u.featured&&u.tier===2),a=t.filter(u=>!u.featured&&u.tier!==2),n=(u,f)=>{const h=u.year||0;return(f.year||0)-h};o.sort(n),i.sort(n),a.sort(n);const r=[...i,...a],c=o.length>0,d=c?o:t,m=c&&r.length>0,l=document.createElement("div");l.className="projects-section",l.setAttribute("data-category",e),l.style.opacity="0",l.style.transform="translateY(10px)",l.style.transition="none";const p=document.createElement("div");p.className="projects-section-header";const y=document.createElement("h2");y.className="projects-section-title";const g=document.createElement("span");if(g.className="projects-section-title-text",g.textContent=s[e],y.appendChild(g),m){const u=document.createElement("button");u.className="projects-section-expand",u.setAttribute("aria-expanded","false"),u.setAttribute("aria-label",w.t("projects.filters.showAllAria")),u.innerHTML=`
        <span class="projects-section-expand-text">${w.t("projects.filters.showAll")}</span>
        <span class="projects-section-expand-count">${t.length}</span>
      `,u.addEventListener("click",()=>{this.toggleSectionExpansion(e,u,r)}),y.appendChild(u)}p.appendChild(y),l.appendChild(p);const E=document.createElement("div");return E.className="projects-section-grid",d.forEach(u=>{const f=this.allProjectCards.get(u.id);if(f){const h=f.cloneNode(!0);h.style.opacity="0",h.style.transform="translateY(10px)",h.style.transition="none",h.addEventListener("click",q=>{q.stopPropagation(),u.comingSoon||this.onCardClick(u)});const C=h.querySelector(".project-card-button");C&&C.addEventListener("click",q=>{q.stopPropagation(),u.comingSoon||this.onCardClick(u)}),E.appendChild(h);const v=h.querySelector("img[data-src]");v&&P.loadImage(v)}}),m&&r.forEach(u=>{const f=this.allProjectCards.get(u.id);if(f){const h=f.cloneNode(!0);h.classList.add("project-card-hidden"),h.setAttribute("data-hidden-card","true"),h.style.display="none",h.style.opacity="0",h.style.transition="none",h.addEventListener("click",q=>{const I=window.getSelection();I&&I.toString().trim().length>0||(q.stopPropagation(),u.comingSoon||this.onCardClick(u))});const C=h.querySelector(".project-card-button");C&&C.addEventListener("click",q=>{q.stopPropagation(),u.comingSoon||this.onCardClick(u)}),E.appendChild(h);const v=h.querySelector("img[data-src]");v&&P.loadImage(v)}}),l.appendChild(E),l}async renderGroupedProjects(){if(this.isRendering){console.warn("renderGroupedProjects уже выполняется");return}const e=document.getElementById("projects-grid");if(!e){console.warn("Сетка проектов не найдена");return}if(this.allProjectCards.size===0){console.warn("Карточки проектов еще не созданы");return}this.isRendering=!0,this.activeTimeouts.forEach((s,o)=>{s.forEach(i=>{clearTimeout(i)})}),this.activeTimeouts.clear(),this.isAnimating.clear(),this.expandedSections.clear();const t=document.getElementById("projects-loading");if(t){const s=window.getComputedStyle(t);s.display!=="none"&&s.visibility!=="hidden"&&parseFloat(s.opacity)>.01&&await this.onHideLoading()}try{e.innerHTML="",e.className="projects-grid",(!e.style.opacity||e.style.opacity==="")&&(e.style.opacity="0"),e.style.visibility="visible";const s={games:[],tools:[],research:[]};this.projects.forEach(n=>{s[n.category]&&s[n.category].push(n)});const o={games:w.t("projects.filters.categories.games"),tools:w.t("projects.filters.categories.tools"),research:w.t("projects.filters.categories.research")};Object.keys(s).forEach(n=>{const r=s[n];if(r.length===0)return;const c=this.createSection(n,r,o);e.appendChild(c)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const n=e.style.opacity;(n==="0"||!n||n==="")&&(e.style.transition=`opacity ${A.duration} ${A.timing}, transform ${A.duration} ${A.timing}`,e.style.opacity="1",e.style.transform="translateY(0)",setTimeout(()=>{e.style.opacity="",e.style.transform="",e.style.transition=""},A.timeout)),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const r=e.querySelectorAll(".projects-section");r.length>0&&b(r),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const c=e.querySelectorAll(".project-card:not(.project-card-hidden)");c.length>0&&b(c)})})})})})});const a=async()=>{try{const n=new F;await new Promise(r=>{window.requestIdleCallback?requestIdleCallback(()=>{n.init().then(r).catch(r)},{timeout:2e3}):setTimeout(()=>{n.init().then(r).catch(r)},0)})}catch(n){console.error("Ошибка загрузки SVG:",n)}finally{this.isRendering=!1}};window.requestIdleCallback?requestIdleCallback(a,{timeout:2e3}):setTimeout(a,100)}catch(s){console.error("Ошибка при рендеринге проектов:",s),this.isRendering=!1}}}class M{constructor(e){this.sectionSelector=e.sectionSelector,this.elementsSelector=e.elementsSelector,this.animationDelay=e.animationDelay||100}hideAllElementsImmediately(e=null){document.querySelectorAll(this.sectionSelector).forEach(s=>{s&&(s.style.setProperty("opacity","0","important"),s.style.setProperty("transform",`translateY(${A.translateYAppear})`,"important"),s.style.setProperty("transition","none","important"),s.querySelectorAll(this.elementsSelector).forEach(i=>{i&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform",`translateY(${A.translateYAppear})`,"important"),i.style.setProperty("transition","none","important"))}),e&&typeof e=="function"&&e(s))})}recheckAndHideElements(){document.querySelectorAll(this.sectionSelector).forEach(t=>{if(t){const s=window.getComputedStyle(t);parseFloat(s.opacity)>.01&&(t.style.setProperty("opacity","0","important"),t.style.setProperty("transform",`translateY(${A.translateYAppear})`,"important"),t.style.setProperty("transition","none","important")),t.querySelectorAll(this.elementsSelector).forEach(a=>{if(a){const n=window.getComputedStyle(a);parseFloat(n.opacity)>.01&&(a.style.setProperty("opacity","0","important"),a.style.setProperty("transform",`translateY(${A.translateYAppear})`,"important"),a.style.setProperty("transition","none","important"))}})}})}forceReflow(e=null){if(e&&e.firstElementChild)e.firstElementChild.offsetHeight;else{const t=document.querySelector(this.sectionSelector);t&&t.firstElementChild&&t.firstElementChild.offsetHeight}}initializeAnimations(){throw new Error("initializeAnimations() must be implemented in child class")}}class R extends M{constructor(){super({sectionSelector:".cv-section, #cv-download-section",elementsSelector:".cv-header-name, .cv-header-role, .cv-header-contacts-wrapper, .cv-header-about, .cv-about-text, .cv-header-photo-image, .cv-section-title, .cv-skills-grid, .cv-skill-category, .timeline-container, .cv-certificate-item, .cv-course-item, .cv-language-item, .cv-download-button",animationDelay:100})}hideAllCVElementsImmediately(){this.hideAllElementsImmediately(e=>{e.querySelectorAll(".timeline-container").forEach(s=>{s&&s.querySelectorAll("*").forEach(i=>{i&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important"))})})})}animateCVSection(e,t={}){if(!e)return;const s=t.delay||0;setTimeout(()=>{const o=[],i=e.querySelector(".cv-section-title");i&&o.push(i);const a=e.querySelectorAll(".timeline-container");a.forEach(m=>{m&&o.push(m)}),e.querySelectorAll(".cv-certificate-item").forEach(m=>{m&&o.push(m)}),e.querySelectorAll(".cv-course-item").forEach(m=>{m&&o.push(m)}),e.querySelectorAll(".cv-language-item").forEach(m=>{m&&o.push(m)}),e.querySelectorAll(".cv-download-button").forEach(m=>{o.push(m)}),x(e),a.forEach(m=>{m&&m.querySelectorAll("*").forEach(p=>{p&&(p.style.setProperty("opacity","",""),p.style.setProperty("transform","",""),p.style.setProperty("transition","",""),p.style.removeProperty("opacity"),p.style.removeProperty("transform"),p.style.removeProperty("transition"))})}),a.length>0&&a[0]&&a[0].offsetHeight,o.length>0&&b(o,{skipInitialState:!0})},s)}animateCVHeader(e){if(!e)return;x(e);const t=[],s=e.querySelector(".cv-header-name"),o=e.querySelector(".cv-header-role"),i=e.querySelector(".cv-header-contacts-wrapper"),a=e.querySelector(".cv-header-photo-image"),n=e.querySelector(".cv-header-about"),r=e.querySelectorAll(".cv-about-text"),c=e.querySelector(".cv-skills-grid"),d=e.querySelectorAll(".cv-skill-category");s&&t.push(s),o&&t.push(o),i&&t.push(i),a&&t.push(a),n&&t.push(n),r.forEach(m=>{m&&t.push(m)}),c&&t.push(c),d.forEach(m=>{m&&t.push(m)}),t.length>0&&b(t,{skipInitialState:!0})}initializeAnimations(){this.hideAllCVElementsImmediately(),this.forceReflow(document.querySelector(".cv-section")),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.recheckAndHideElements();const e=document.querySelectorAll(this.sectionSelector);e.length>0&&e[0].firstElementChild&&e[0].firstElementChild.offsetHeight,setTimeout(()=>{const t=[],s=document.getElementById("cv-header-section");if(s&&s.children.length>0){const i=s.querySelector(".cv-header-name"),a=s.querySelector(".cv-header-role"),n=s.querySelector(".cv-header-contacts-wrapper"),r=s.querySelector(".cv-header-photo-image"),c=s.querySelector(".cv-header-about"),d=s.querySelectorAll(".cv-about-text"),m=s.querySelector(".cv-skills-grid"),l=s.querySelectorAll(".cv-skill-category");i&&t.push(i),a&&t.push(a),n&&t.push(n),r&&t.push(r),c&&t.push(c),d.forEach(p=>{p&&t.push(p)}),m&&t.push(m),l.forEach(p=>{p&&t.push(p)}),x(s)}[document.getElementById("cv-work-section"),document.getElementById("cv-education-section"),document.getElementById("cv-certificates-section"),document.getElementById("cv-courses-section"),document.getElementById("cv-languages-section"),document.getElementById("cv-download-section")].forEach(i=>{if(i&&i.children.length>0){x(i);const a=i.querySelector(".cv-section-title");a&&t.push(a),i.querySelectorAll(".timeline-container").forEach(l=>{l&&(t.push(l),l.querySelectorAll("*").forEach(y=>{y&&(y.style.setProperty("opacity","",""),y.style.setProperty("transform","",""),y.style.setProperty("transition","",""),y.style.removeProperty("opacity"),y.style.removeProperty("transform"),y.style.removeProperty("transition"))}))}),i.querySelectorAll(".cv-certificate-item").forEach(l=>{l&&t.push(l)}),i.querySelectorAll(".cv-course-item").forEach(l=>{l&&t.push(l)}),i.querySelectorAll(".cv-language-item").forEach(l=>{l&&t.push(l)}),i.querySelectorAll(".cv-download-button").forEach(l=>{t.push(l)})}}),t.length>0&&t[0]&&t[0].offsetHeight,t.length>0&&(t.forEach(i=>{if(i){const a=window.getComputedStyle(i);parseFloat(a.opacity)>.01&&(i.style.setProperty("opacity","0","important"),i.style.setProperty("transform","translateY(10px)","important"),i.style.setProperty("transition","none","important"))}}),t.length>0&&t[0]&&t[0].offsetHeight,b(t,{skipInitialState:!1}))},this.animationDelay)})})}}class _ extends M{constructor(){super({sectionSelector:".community-section",elementsSelector:".community-section-title, .community-card, .community-card-discord, .community-events-list, .community-event-item",animationDelay:100})}hideAllCommunityElementsImmediately(){this.hideAllElementsImmediately()}initializeAnimations(){this.hideAllCommunityElementsImmediately(),this.forceReflow(document.querySelector(".community-section")),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.recheckAndHideElements();const e=document.querySelectorAll(this.sectionSelector);e.length>0&&e[0].firstElementChild&&e[0].firstElementChild.offsetHeight,setTimeout(()=>{const t=[];e.forEach(s=>{if(s&&s.children.length>0){x(s);const o=s.querySelector(".community-section-title");o&&t.push(o),s.querySelectorAll(".community-card, .community-card-discord").forEach(n=>{n&&t.push(n)}),s.querySelectorAll(".community-event-item").forEach(n=>{n&&t.push(n)})}}),t.length>0&&t[0]&&t[0].offsetHeight,t.length>0&&(t.forEach(s=>{if(s){const o=window.getComputedStyle(s);parseFloat(o.opacity)>.01&&(s.style.setProperty("opacity","0","important"),s.style.setProperty("transform","translateY(10px)","important"),s.style.setProperty("transition","none","important"))}}),t.length>0&&t[0]&&t[0].offsetHeight,b(t,{skipInitialState:!1}))},this.animationDelay)})})}}export{R as C,D as P,$ as S,_ as a,W as b};
